version:          '2'
services:
  api-main:
    build:        ./api-main
    volumes:
       - ./api-main:/project
    working_dir:  /project
    ports:
      - "91:1323"
    environment:
      - JWT_KEY=${JWT_KEY}
      - HOST=${HOST}
      - HOST_DB_API=${HOST_DB_API}
      - HOST_MQTT=${HOST_MQTT}
      - BIN_APP_PORT=1323
    depends_on:
      - db-api
    command:      fresh
  db-api:
    build:        ./db-api
    volumes:
       - ./db-api/src:/app
#    remove ports on production
    ports:
      - "3000:5000"
    environment:
      - SQLALCHEMY_DATABASE_URI=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@db:5432/${POSTGRES_DB}
      - JWT_SECRET=${JWT_KEY}
      - JWT_ISSUER=skilmu
      - DEBUG=1
    depends_on:
      - db
  db-admin:
    image:      adminer
    ports:
      - "99:8080"
    depends_on:
      - db
  db:
    build:       ./db
    environment:
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - POSTGRES_DB=${POSTGRES_DB}
